generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

model Company {
  id          String   @id @default(cuid())
  name        String
  email       String   @unique
  companyLogo String?
  phone       String?
  
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  users       User[]
  attendances Attendance[]
  attendanceEntries AttendanceEntry[]
  leaveRequests LeaveRequest[]
  leaveLedgers LeaveLedger[]
}

enum Role {
  HR
  EMPLOYEE
}
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  loginId   String?  @unique
  role      Role     @default(EMPLOYEE)
  
  mobile    String?
  department String?
  manager   String?
  location  String?
  profileImage String?
  
  about     String?
  jobLove   String?
  interests String?

  companyId String
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  salaryInfo SalaryInfo?
  
  skills    Skill[]
  certifications Certification[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  attendances Attendance[]
  attendanceEntries AttendanceEntry[]
  leaveRequests LeaveRequest[]
  leaveLedgers LeaveLedger[]

  @@map("users")
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  HALF_DAY
  LEAVE
}

model Attendance {
  id          String   @id @default(cuid())
  date        DateTime @db.Date 
  
  status      AttendanceStatus @default(PRESENT)
  totalHours  Float?   @default(0) 
  
  notes       String?  @db.Text 
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  entries     AttendanceEntry[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([userId, date]) 
  @@index([userId, date])
  @@index([companyId, date])
  @@index([status])
  @@map("attendances")
}

model AttendanceEntry {
  id          String   @id @default(cuid())
  
  checkIn     DateTime 
  checkOut    DateTime?
  
  duration    Float?   
  location    String?  
  notes       String?  
  
  attendanceId String
  attendance   Attendance @relation(fields: [attendanceId], references: [id], onDelete: Cascade)
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([attendanceId])
  @@index([userId, checkIn])
  @@index([companyId, checkIn])
  @@map("attendance_entries")
}

enum LeaveType {
  PAID
  SICK
  UNPAID
  EXTRA
}

enum LeaveStatus {
  PENDING
  APPROVED
  REJECTED
}

model LeaveRequest {
  id            String      @id @default(cuid())
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  companyId     String
  company       Company     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  leaveType     LeaveType
  startDate     DateTime    @db.Date
  endDate       DateTime    @db.Date
  remarks       String?     @db.Text
  status        LeaveStatus @default(PENDING)
  adminComment  String?     @db.Text
  
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([userId])
  @@index([status])
  @@index([startDate])
  @@index([companyId, status])
  @@map("leave_requests")
}

enum LeaveLedgerReason {
  ACCRUAL
  LEAVE_APPROVED
  MANUAL_ADJUSTMENT
}

model LeaveLedger {
  id          String   @id @default(cuid())

  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)

  leaveType   LeaveType
  change      Int     
  reason      LeaveLedgerReason
  referenceId String? 

  createdAt   DateTime @default(now())

  @@index([userId, leaveType])
  @@index([companyId])
  @@index([userId])
  @@index([referenceId])
  @@map("leave_ledgers")
}

model SalaryInfo {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  monthlyWage    Decimal  @default(0)
  yearlyWage     Decimal  @default(0)
  workingDaysPerWeek Int?
  breakTimeHours     Decimal?
  
  basicSalary         Decimal  @default(0)
  basicSalaryPercent  Decimal  @default(0)
  
  houseRentAllowance  Decimal  @default(0)
  hraPercent          Decimal  @default(0)
  
  standardAllowance   Decimal  @default(0)
  standardPercent     Decimal  @default(0)
  
  performanceBonus    Decimal  @default(0)
  performancePercent  Decimal  @default(0)
  
  leaveTravelAllowance Decimal @default(0)
  ltaPercent          Decimal  @default(0)
  
  fixedAllowance      Decimal  @default(0)
  fixedPercent        Decimal  @default(0)
  
  employeePF          Decimal  @default(0)
  employeePFPercent   Decimal  @default(0)
  
  employerPF          Decimal  @default(0)
  employerPFPercent   Decimal  @default(0)
  
  professionalTax     Decimal  @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Skill {
  id        String   @id @default(cuid())
  name      String
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}

model Certification {
  id        String   @id @default(cuid())
  name      String
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}